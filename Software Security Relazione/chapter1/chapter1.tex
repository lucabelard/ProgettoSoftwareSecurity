\chapter{Valutazione del Rischio}

\begin{preamble}
In questo capitolo viene presentata un'analisi approfondita della sicurezza del sistema, condotta attraverso metodologie formali e strutturate. L'analisi inizia con la modellazione degli obiettivi e delle dipendenze strategiche tramite framework \textbf{i* (iStar)}, prosegue con la valutazione delle minacce mediante approccio \textbf{DUAL-STRIDE} esteso agli asset dell'attore sistema, e si conclude con la definizione di scenari di \textbf{Abuse e Misuse Cases}.
\end{preamble}

\section{Modellazione i* (iStar)}
Per comprendere appieno il contesto organizzativo e tecnico, sono stati realizzati diversi modelli i*, che evidenziano attori, obiettivi (Goals), compiti (Tasks) e risorse (Resources).

\subsection{Supply Chain As-Is (Senza Sistema)}
Il primo modello Strategic Dependency (SD) rappresenta la supply chain tradizionale.
\begin{itemize}
    \item \textbf{Attori}: Produttore, Distributore, Farmacia, Paziente.
    \item \textbf{Criticità}: L'analisi SR (Strategic Rationale) evidenzia dipendenze di "fiducia cieca" tra gli attori riguardo l'integrità della temperatura. Il Produttore dipende dal Distributore per la corretta conservazione, ma non ha mezzi diretti di verifica (Softgoal "Integrità non verificabile").
\end{itemize}

\begin{figure}[ht!]
    \centering
    \includegraphics[width=\linewidth, keepaspectratio]{chapter1/image/sd_as_is.png}
    \caption{Modello SD: Supply Chain As-Is (Senza Sistema)}
    \label{fig:sd_as_is}
\end{figure}

\subsection{Supply Chain To-Be (Con Sistema Blockchain)}
L'introduzione del sistema introduce nuove dipendenze strategiche più robuste.
\begin{itemize}
    \item \textbf{Nuovi Attori}: Sistema Smart Contract, Oracolo IoT.
    \item \textbf{Vantaggi}: Il Softgoal "Integrità Verificabile" è ora soddisfatto dalla risorsa "Registro Immutabile" fornita dal sistema. Gli attori umani dipendono dal Sistema per la validazione, non più dalla fiducia reciproca.
\end{itemize}

\begin{figure}[ht!]
    \centering
    \includegraphics[width=\linewidth, keepaspectratio]{chapter1/image/sd_to_be.png}
    \caption{Modello SD: Supply Chain To-Be (Con Sistema Blockchain)}
    \label{fig:sd_to_be}
\end{figure}

\subsection{Sistema e Attaccanti}
Sono stati modellati tre profili di attaccante interagenti con il sistema:
\begin{enumerate}
    \item \textbf{Attaccante Interno (Malicious Insider)}: Un operatore logistico corrotto che tenta di manipolare i sensori fisici.
    \item \textbf{Attaccante Esterno}: Un hacker remoto che tenta attacchi di rete (DoS, intercettazione) o exploit sugli Smart Contract.
    \item \textbf{Utente Maldestro (Clumsy User)}: Un operatore che commette errori non intenzionali (es. perdita chiavi private, input errati).
\end{enumerate}
Per ciascun attaccante, i diagrammi SR includono \textbf{Alberi di Attacco (Attack Trees)} integrati, che mostrano la decomposizione degli obiettivi malevoli (es. "Falsificare Report Temperatura") in sotto-task operativi.

\begin{figure}[ht!]
    \centering
    \includegraphics[width=\linewidth, keepaspectratio]{chapter1/image/sd_attackers.png}
    \caption{Modello SD: Sistema e Attaccanti con Alberi di Attacco}
    \label{fig:sd_attackers}
\end{figure}

\begin{figure}[ht!]
    \centering
    \includegraphics[width=\linewidth,keepaspectratio]{chapter1/image/sr_attackers.png}
    \caption{Modello SR: Dettaglio Attaccanti e Alberi di Attacco}
    \label{fig:sr_attackers}
\end{figure}

\section{Analisi DUAL-STRIDE}
L'analisi delle minacce è stata condotta metodicamente raggruppando gli asset secondo il paradigma DUAL-STRIDE, focalizzandosi specificamente sugli asset dell'\textbf{Attore Sistema}.

\subsection{Identificazione degli Asset}
Gli asset primari analizzati sono:
\begin{itemize}
    \item \textbf{Smart Contract (Logica)}: Codice Solidity distribuito.
    \item \textbf{Dati della Blockchain (Ledger)}: Storico transazioni e stati.
    \item \textbf{Credenziali (Chiavi Private)}: Chiavi dei nodi validatori e degli utenti.
    \item \textbf{Oracolo (Infrastruttura IoT)}: Ponte tra mondo fisico e digitale.
\end{itemize}

\subsection{Matrice delle Minacce (Riferimenti CAPEC/ATT\&CK)}
Per ogni categoria STRIDE sono stati identificati vettori di attacco specifici, mappati sui framework standard \textbf{CAPEC} e \textbf{MITRE ATT\&CK}.

\begin{table}[h]
\centering
\small % Riduci la dimensione del font
\begin{tabularx}{\textwidth}{@{}l X l@{}}
\toprule
\textbf{STRIDE} & \textbf{Minaccia Identificata} & \textbf{Rif. CAPEC} \\ \midrule
\textbf{S}poofing & Impersonificazione di un nodo validatore & CAPEC-151 (Identity Spoofing) \\ \midrule
\textbf{T}ampering & Modifica dati sensore pre-invio (Data Injection) & CAPEC-155 (Screen/Data Capture) \\ \midrule
\textbf{R}epudiation & Negazione di avvenuta consegna del lotto & CAPEC-390 (Bypassing Checks) \\ \midrule
\textbf{I}nformation Disc. & Lettura transazioni private (Analisi traffico) & CAPEC-118 (Traffic Analysis) \\ \midrule
\textbf{D}enial of Service & Spam di transazioni per bloccare la rete & CAPEC-488 (HTTP Flood/Gas Limit) \\ \midrule
\textbf{E}levation of Priv. & Sfruttamento bug in AccessControl & CAPEC-233 (Privilege Escalation) \\ \bottomrule
\end{tabularx}
\caption{Analisi STRIDE sugli Asset del Sistema}
\label{tab:stride_analysis}
\end{table}

\section{Abuse e Misuse Cases}
Per completare l'analisi, sono stati definiti scenari operativi di abuso per ogni asset critico.

\subsection{Abuse Case: Iniezione Dati Falsi (Attaccante Interno)}
\begin{itemize}
    \item \textbf{Attore}: Insider Logistico.
    \item \textbf{Obiettivo}: Nascondere un'escursione termica per evitare penali.
    \item \textbf{Asset}: Oracolo IoT.
    \item \textbf{Scenario}: L'attaccante manomette fisicamente il sensore o inietta pacchetti MQTT falsificati verso l'Oracolo.
    \item \textbf{Mitigazione}: Validazione Bayesiana per rilevare incongruenze statistiche (v. Cap. 4).
\end{itemize}

\subsection{Misuse Case: Smarrimento Chiave Privata (Utente Maldestro)}
\begin{itemize}
    \item \textbf{Attore}: Farmacista.
    \item \textbf{Evento}: L'utente cancella accidentalmente il file keystore o lo condivide su canali non sicuri.
    \item \textbf{Conseguenza}: Perdita di accesso ai fondi o furto d'identità.
    \item \textbf{Mitigazione}: Procedure di key-recovery off-chain (non implementate on-chain per scelta di design) e formazione operativa.
\end{itemize}

% --- Definizioni Colonna Custom ---
\newcolumntype{L}{>{\raggedright\arraybackslash}X}

% --- Colori Personalizzati Tabella Grande (Capitolo 1-2) ---
\definecolor{headerblue}{RGB}{51, 122, 183}
\definecolor{stripeblue}{RGB}{235, 245, 255}
\definecolor{letterred}{RGB}{255, 0, 0}

% --- Colori Personalizzati Capitolo 3 (Abuse/Misuse) ---
% Arancione per Abuse Cases
\definecolor{abuseHeader}{RGB}{255, 140, 0}   % Arancione scuro
\definecolor{abuseCol}{RGB}{255, 229, 204}    % Arancione molto chiaro
% Blu per Misuse Cases
\definecolor{misuseHeader}{RGB}{65, 105, 225} % Royal Blue
\definecolor{misuseCol}{RGB}{230, 240, 255}   % Blu molto chiaro

% --- Comandi Personalizzati per la Tabella Grande ---
\newcommand{\rotheader}[2]{%
    \rotatebox{90}{\parbox{3cm}{\raggedright \textcolor{letterred}{\textbf{#1}}#2}}}
\newcommand{\chk}{$\bullet$}

% --- INIZIO TABELLA GRANDE (LANDSCAPE) ---
\newgeometry{top=1.5cm, bottom=1.5cm, left=1.5cm, right=1.5cm}
\begin{landscape}

\section{Riepilogo Visuale Minacce (DUAL-STRIDE)}

\setlength\tabcolsep{3pt}
\small
\begin{longtable}{|l|l|c|c|c|c|c|c|c|c|c|c|p{6cm}|p{5cm}|}
\hline
\rowcolor{headerblue}
\multicolumn{1}{|c|}{\textcolor{white}{\textbf{Asset}}} & 
\multicolumn{1}{c|}{\textcolor{white}{\textbf{Valore}}} & 
\rotheader{S}{poofing} & 
\rotheader{T}{ampering} & 
\rotheader{R}{epudiation} & 
\rotheader{I}{nformation disclosure} & 
\rotheader{D}{enaial of service} & 
\rotheader{E}{levation of privilege} & 
\rotheader{D}{anger} & 
\rotheader{U}{nreliability} & 
\rotheader{A}{bsence of resilience} & 
\rotheader{L}{eakage} & 
\multicolumn{1}{c|}{\textcolor{white}{\textbf{Descrizione Attacco}}} & 
\multicolumn{1}{c|}{\textcolor{white}{\textbf{Mitigazione (Control)}}} \\
\hline
\endfirsthead

\hline
\rowcolor{headerblue}
\multicolumn{1}{|c|}{\textcolor{white}{\textbf{Asset}}} & 
\multicolumn{1}{c|}{\textcolor{white}{\textbf{Valore}}} & 
\rotheader{S}{poofing} & 
\rotheader{T}{ampering} & 
\rotheader{R}{epudiation} & 
\rotheader{I}{nformation Disclosure} & 
\rotheader{D}{oS} & 
\rotheader{E}{levation of privilege} & 
\rotheader{D}{anger} & 
\rotheader{U}{nreliability} & 
\rotheader{A}{bsence of resilience} & 
\rotheader{L}{eakage/Exp.} & 
\multicolumn{1}{c|}{\textcolor{white}{\textbf{Descrizione Attacco}}} & 
\multicolumn{1}{c|}{\textcolor{white}{\textbf{Mitigazione (Control)}}} \\
\hline
\endhead

% --- DATA ROWS ---

% A1
\rowcolor{stripeblue}
A1 & Critico & & \chk & & & & & \chk & & & & T1.1: manipolazione logica bytecode & Audit + Verifica formale \\
\hline
A1 & Critico & & & & & \chk & & & & \chk & & D1.1: blocco contratto (storage bomb) & Gas limits \\
\hline
\rowcolor{stripeblue}
A1 & Critico & & & & & & \chk & & & & \chk & E1.1: privilege escalation admin & Est. Gnosis Safe Multi-sig \\
\hline

% A2
A2 & Critico & \chk & & & & & & \chk & & & & S2.1: impersonificazione sensore & Role-based access \\
\hline
\rowcolor{stripeblue}
A2 & Critico & & \chk & & & & & \chk & & & & T2.1: modifica evidenze in transito & Firma tx (Sender Auth) \\
\hline
A2 & Critico & & & \chk & & & & & & & & R2.1: ripudio invio evidenza & Event logging \\
\hline
\rowcolor{stripeblue}
A2 & Critico & & & & \chk & & & & \chk & & & I2.1: corruzione dati sensore & Ridondanza E1-E5 \\
\hline

% A3
A3 & Critico & & \chk & & & & & \chk & & & & T3.1: reentrancy attack & ReentrancyGuard \\
\hline
\rowcolor{stripeblue}
A3 & Critico & & & & & \chk & & & & \chk & & D3.1: blocco fondi escrow & Refund logic + timeout \\
\hline
A3 & Critico & & & & & & \chk & & & & \chk & E3.1: drenaggio fondi contratto & Push Payment + ReentrancyGuard \\
\hline

% A4
\rowcolor{stripeblue}
A4 & Alto & \chk & & & & & & \chk & & & & S4.1: assegnazione ruolo fraudolenta & Admin-only grant \\
\hline
A4 & Alto & & \chk & & & & & \chk & & & & T4.1: modifica mapping ruoli & Private state vars \\
\hline
\rowcolor{stripeblue}
A4 & Alto & & & & & & \chk & & & & \chk & E4.1: escalation privilegi & Multi-level checks \\
\hline

% A5
A5 & Alto & & \chk & & & & & \chk & & & & T5.1: manipolazione CPT & Private vars + Admin \\
\hline
\rowcolor{stripeblue}
A5 & Alto & & & & \chk & & & & & & \chk & I5.1: reverse engineering CPT & Offuscamento \\
\hline
A5 & Alto & & & & & & \chk & & & & \chk & E5.1: leak parametri bayesiani & Private getter \\
\hline

% A6
\rowcolor{stripeblue}
A6 & Medio & & & & \chk & & & & & & \chk & I6.1: data mining competitivo & Hashing dati sensibili \\
\hline
A6 & Medio & & \chk & & & & & & & & & T6.1: modifica storico spedizioni & Immutabilità blockchain \\
\hline
\rowcolor{stripeblue}
A6 & Medio & & & \chk & & & & & & & & R6.1: ripudio transazione & Event logs permanenti \\
\hline

% A7
A7 & Medio & \chk & & & & & & \chk & & & & S7.1: phishing/Spoofing UI & User ed. + HTTPS \\
\hline
\rowcolor{stripeblue}
A7 & Medio & & \chk & & & & & \chk & & & & T7.1: MITM su connessione Web3 & TLS + SRI \\
\hline
A7 & Medio & & & & \chk & & & & & & \chk & I7.1: XSS injection & Input sanitization \\
\hline

% A8
\rowcolor{stripeblue}
A8 & Critico & \chk & & & & & & \chk & & & & S8.1: furto chiavi (keylogger) & Hardware wallet \\
\hline
A8 & Critico & & & & \chk & & & & & & \chk & I8.1: esposizione seed phrase & Secure storage ed. \\
\hline
\rowcolor{stripeblue}
A8 & Critico & & & & & & \chk & & & & \chk & E8.1: accesso non autorizzato wallet & Pwd policy + 2FA \\
\hline

\end{longtable}
\end{landscape}
\restoregeometry
\newpage
% --- FINE TABELLA GRANDE ---

\section{Inventario Asset del Sistema}

\begin{tabularx}{\textwidth}{l l L l}
\toprule
\textbf{ID} & \textbf{Asset} & \textbf{Descrizione} & \textbf{Criticità} \\
\midrule
A1 & Smart Contract & logica di business e fondi in escrow & \textbf{Critica} \\
A2 & Evidenze IoT & dati dai sensori (E1-E5) & \textbf{Critica} \\
A3 & Pagamenti ETH & fondi depositati dai mittenti & \textbf{Critica} \\
A4 & Ruoli e Permessi & sistema AccessControl & \textbf{Alta} \\
A5 & CPT e Probabilità & parametri della rete bayesiana & \textbf{Alta} \\
A6 & Dati spedizioni & record on-chain e storico & \textbf{Media} \\
A7 & Interfaccia Web & frontend utente (DApp) & \textbf{Media} \\
A8 & Chiavi private & credenziali MetaMask & \textbf{Critica} \\
\bottomrule
\end{tabularx}

\newpage

\section{Abuse e Misuse Cases Dettagliati}

\subsection{S2.1 - Impersonificazione Sensore}

\subsubsection*{ABUSE CASE: S2.1-A}
% Abuse Case = Arancione
\begin{longtable}{| >{\columncolor{abuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{abuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Abuse Case \\
\hline
\textbf{Use Case} & invio Evidenza Sensore \\
\hline
\textbf{Case ID} & S2.1-A \\
\hline
\textbf{Case Name} & \textbf{sensore Malevolo Falsificato} \\
\hline
\textbf{Actors} & attaccante Esterno con chiave compromessa RUOLO\_SENSORE \\
\hline
\textbf{Description} & Un attaccante riesce ad ottenere la chiave privata di un account con RUOLO\_SENSORE (ad esempio tramite phishing, malware IoT o compromissione fisica del dispositivo) e la sfrutta per inviare evidenze falsificate allo smart contract, facendo sì che spedizioni non conformi vengano erroneamente validate. \\
\hline
\textbf{Data} & chiave privata RUOLO\_SENSORE, ID spedizione target, valori evidenze falsificati (E1-E5) \\
\hline
\textbf{Stimulus/Precond.} & - Spedizione in stato InAttesa \newline - Attaccante possiede chiave con RUOLO\_SENSORE \newline - Target: spedizione con merce deteriorata (temperatura fuori range) \\
\hline
\textbf{Basic Flow} & 1. L'attaccante individua la spedizione target monitorando gli eventi sulla blockchain \newline 2. Chiama \texttt{inviaEvidenza(idSpedizione, 1, true)} inserendo valori positivi \newline 3. Ripete l'operazione per E2-E5 con valori falsificati \newline 4. Il corriere chiama \texttt{validaEPaga()} e il sistema valida la spedizione \newline 5. Il corriere viene pagato per merce non conforme, a danno del mittente \\
\hline
\textbf{Alternative Flow} & - Se la transazione viene rifiutata per mancanza del ruolo, l'attacco fallisce senza conseguenze \newline - Se l'evidenza per quel sensore è già registrata, l'attaccante tenta con un altro account compromesso \\
\hline
\textbf{Exception Flow} & - Il sistema rileva che le evidenze arrivano troppo ravvicinate nel tempo (anomalia temporale) \newline - Invii multipli dallo stesso sensore per la stessa spedizione vengono bloccati automaticamente \\
\hline
\textbf{Response/Post.} & \textbf{Se l'attacco riesce:} il mittente paga per merce non conforme, che viene consegnata senza verifiche reali \newline \textbf{Tracciabilità:} tutte le transazioni restano registrate sulla blockchain, utili per analisi a posteriori \\
\hline
\textbf{Comments} & \textbf{CAPEC-151:} Identity Spoofing \newline \textbf{Contromisure consigliate:} rotazione periodica delle chiavi dei sensori, vincolo hardware tra chiave e dispositivo fisico, autenticazione tramite challenge-response \\
\hline
\end{longtable}

\subsubsection*{MISUSE CASE: S2.1-M}
% Misuse Case = Blu
\begin{longtable}{| >{\columncolor{misuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{misuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Misuse Case \\
\hline
\textbf{Use Case} & invio Evidenza Sensore \\
\hline
\textbf{Case ID} & S2.1-M \\
\hline
\textbf{Case Name} & \textbf{guasto Hardware Sensore (Unreliability)} \\
\hline
\textbf{Actors} & sensore IoT difettoso/starato \\
\hline
\textbf{Description} & Un sensore IoT legittimamente autorizzato trasmette dati errati a causa di problemi hardware: deriva della calibrazione, batteria in esaurimento o interferenze elettromagnetiche nell'ambiente di trasporto. Questo pu\`o generare falsi positivi o negativi non intenzionali nella valutazione della spedizione. \\
\hline
\textbf{Data} & letture sensore errate, timestamp \\
\hline
\textbf{Stimulus/Precond.} & - Sensore installato da >6 mesi senza calibrazione \newline - Ambiente con interferenze elettromagnetiche \newline - Batteria sotto 20\% \\
\hline
\textbf{Basic Flow} & 1. Il sensore di temperatura presenta una deriva di +2\textdegree C \newline 2. Una spedizione mantenuta a 4\textdegree C viene letta come 6\textdegree C (fuori dal range 2-8\textdegree C) \newline 3. Il sensore invia \texttt{E1=false} in modo erroneo \newline 4. La rete bayesiana calcola una probabilit\`a bassa di conformit\`a \newline 5. La validazione fallisce e il mittente perde il pagamento depositato \\
\hline
\textbf{Alternative Flow} & - Gli altri sensori (E2-E5) compensano parzialmente l'errore di E1 grazie alla ridondanza bayesiana \newline - Se il timeout di 7 giorni scade prima della validazione, il mittente pu\`o richiedere il rimborso automatico \\
\hline
\textbf{Exception Flow} & - Il sistema di ridondanza rileva un'incongruenza tra i dati dei diversi sensori \newline - L'amministratore interviene manualmente per risolvere la situazione \\
\hline
\textbf{Response/Post.} & \textbf{Impatto:} falso negativo --- merce conforme viene rifiutata, il mittente subisce una perdita economica ingiusta \newline \textbf{Requisiti non funzionali:} contratti di manutenzione con SLA, calibrazione almeno semestrale, monitoraggio livello batteria \\
\hline
\textbf{Comments} & \textbf{DUA-Unreliability:} l'assenza di manutenzione preventiva è la causa principale \newline \textbf{Contromisure consigliate:} rilevamento automatico della deriva tramite algoritmi di apprendimento, consenso tra sensori multipli \\
\hline
\end{longtable}

\subsection{T3.1 - Reentrancy Attack su Pagamenti}

\subsubsection*{ABUSE CASE: T3.1-A}
% Abuse Case = Arancione
\begin{longtable}{| >{\columncolor{abuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{abuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Abuse Case \\
\hline
\textbf{Use Case} & pagamento Mittente \\
\hline
\textbf{Case ID} & T3.1-A \\
\hline
\textbf{Case Name} & \textbf{reentrancy Attack su validaEPaga} \\
\hline
\textbf{Actors} & Attaccante che deploya uno smart contract malevolo registrato come corriere \\
\hline
\textbf{Description} & L'attaccante deploya uno smart contract malevolo dotato di una funzione \texttt{receive()} che richiama automaticamente \texttt{validaEPaga()}. In assenza di protezioni, quando BNPagamenti esegue il trasferimento fondi al corriere tramite \texttt{.call\{value\}}, la fallback rientra nella funzione prima dell'aggiornamento dello stato, consentendo pagamenti multipli dalla stessa spedizione. \\
\hline
\textbf{Data} & Contratto corriere malevolo con fallback, ID spedizione, saldo complessivo dello smart contract \\
\hline
\textbf{Stimulus/Precond.} & - Un mittente (complice o ignaro) crea una spedizione specificando il contratto malevolo come corriere \newline - La spedizione ha tutte le evidenze complete e valide \newline - Lo smart contract detiene fondi in escrow di più spedizioni attive \\
\hline
\textbf{Basic Flow} & 1. L'attaccante deploya un contratto con \texttt{receive()} malevola \newline 2. Una spedizione viene creata con questo contratto come corriere \newline 3. Le evidenze vengono inviate e risultano valide \newline 4. Il contratto malevolo (corriere) chiama \texttt{validaEPaga()} \newline 5. BNPagamenti esegue \texttt{corriere.call\{value: importo\}("")} \newline 6. La fallback ri-chiama \texttt{validaEPaga()}, \texttt{stato == InAttesa} ancora vero $\to$ secondo pagamento \newline 7. Il ciclo si ripete drenando i fondi nel contratto \\
\hline
\textbf{Alternative Flow} & - Se il ReentrancyGuard è attivo, la seconda chiamata viene immediatamente annullata con un revert \newline - Se si segue il pattern Checks-Effects-Interactions, lo stato viene aggiornato prima del trasferimento, impedendo la rientranza \\
\hline
\textbf{Exception Flow} & - Il ciclo si interrompe per esaurimento del gas \newline - Il saldo del contratto diventa insufficiente e la transazione va in revert \\
\hline
\textbf{Response/Post.} & \textbf{Se l'attacco riesce:} tutti i fondi presenti nel contratto vengono drenati \newline \textbf{Se l'attacco fallisce:} la transazione viene annullata, nessun pagamento avviene \\
\hline
\textbf{Comments} & \textbf{CAPEC-194:} Fake Resource Injection \newline \textbf{ATT\&CK:} T1539 (per analogia) \newline \textbf{Contromisure implementate:} OpenZeppelin ReentrancyGuard, pattern CEI (lo stato viene aggiornato prima del trasferimento fondi), pagamento diretto protetto dal guard \\
\hline
\end{longtable}

\subsubsection*{MISUSE CASE: T3.1-M}
% Misuse Case = Blu
\begin{longtable}{| >{\columncolor{misuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{misuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Misuse Case \\
\hline
\textbf{Use Case} & creazione Spedizione \\
\hline
\textbf{Case ID} & T3.1-M \\
\hline
\textbf{Case Name} & \textbf{errore Indirizzo Corriere (User Mistake)} \\ % CORRETTO TITOLO
\hline
\textbf{Actors} & mittente distratto \\
\hline
\textbf{Description} & Il mittente inserisce per errore un indirizzo sbagliato nel campo ``Corriere'' durante la creazione della spedizione. Dato che la blockchain non verifica l'identit\`a reale dietro un indirizzo, il pagamento finale verr\`a inviato all'indirizzo errato senza possibilit\`a di annullamento. \\
\hline
\textbf{Data} & indirizzo corriere errato, fondi ETH depositati \\
\hline
\textbf{Stimulus/Precond.} & - Creazione spedizione tramite la DApp \newline - Inserimento manuale dell'indirizzo del corriere \newline - Nessuna validazione del checksum o dell'identit\`a del destinatario \\
\hline
\textbf{Basic Flow} & 1. Il mittente inserisce l'indirizzo del corriere con un errore di battitura (ad esempio \texttt{0xAb...} invece di \texttt{0xAc...}) \newline 2. La spedizione viene completata regolarmente dai sensori \newline 3. La funzione \texttt{validaEPaga()} trasferisce i fondi all'indirizzo sbagliato \newline 4. Il corriere reale non riceve il compenso pattuito \\
\hline
\textbf{Alternative Flow} & - Se l'indirizzo errato ha un checksum valido, i fondi finiscono a uno sconosciuto o vengono ``bruciati'' \\
\hline
\textbf{Exception Flow} & - Un'interfaccia con rubrica indirizzi o lettura QR code previene l'errore di digitazione \\
\hline
\textbf{Response/Post.} & \textbf{Impatto:} perdita dei fondi versati, possibile contenzioso legale con il corriere reale \newline \textbf{Requisiti non funzionali:} interfaccia con selezione da elenco di corrieri certificati \\
\hline
\textbf{Comments} & \textbf{DUA-Exposure:} l'interfaccia espone l'utente a errori umani costosi \newline \textbf{Contromisure consigliate:} lista bianca di corrieri verificati, rubrica indirizzi integrata nella DApp \\
\hline
\end{longtable}

\subsection{D3.1 - Blocco Fondi Escrow}

\subsubsection*{ABUSE CASE: D3.1-A}
% Abuse Case = Arancione
\begin{longtable}{| >{\columncolor{abuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{abuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Abuse Case \\
\hline
\textbf{Use Case} & validazione Spedizione \\
\hline
\textbf{Case ID} & D3.1-A \\
\hline
\textbf{Case Name} & \textbf{withholding Attack (Denial of Service)} \\
\hline
\textbf{Actors} & sensore compromesso / Corriere collusivo \\
\hline
\textbf{Description} & Un attaccante che controlla un sensore (ad esempio E5) oppure un corriere collusivo rifiuta intenzionalmente di inviare l'ultima evidenza necessaria alla validazione, bloccando cos\`i i fondi del mittente in escrow come forma di estorsione o per arrecare danno reputazionale al sistema. \\
\hline
\textbf{Data} & ID spedizione, evidenze E1-E4 (inviate), E5 (trattenuta) \\
\hline
\textbf{Stimulus/Precond.} & - Spedizione in stato InAttesa \newline - Evidenze E1-E4 già registrate on-chain \newline - L'attaccante controlla il sensore E5 oppure l'account corriere \newline - Scenario ipotetico senza meccanismo di timeout \\
\hline
\textbf{Basic Flow} & 1. La spedizione procede normalmente nelle fasi iniziali \newline 2. I sensori E1-E4 inviano regolarmente le loro evidenze \newline 3. L'attaccante trattiene deliberatamente E5 a tempo indeterminato \newline 4. Senza tutte le evidenze, \texttt{validaEPaga()} non pu\`o essere chiamata \newline 5. I fondi del mittente restano bloccati nel contratto \\
\hline
\textbf{Alternative Flow} & - L'attaccante chiede un riscatto in cambio dell'invio di E5 \newline - Pi\`u sensori vengono compromessi contemporaneamente (E3+E4+E5) per rendere l'attacco pi\`u robusto \\
\hline
\textbf{Exception Flow} & - Allo scadere del timeout di 7 giorni, il mittente pu\`o chiamare \texttt{richiestaRimborso()} per recuperare i fondi \newline - L'amministratore interviene in caso di emergenza \\
\hline
\textbf{Response/Post.} & \textbf{Se l'attacco riesce:} blocco temporaneo dei fondi, danno alla reputazione del sistema, possibile estorsione \newline \textbf{Contromisura attiva:} rimborso automatico allo scadere del timeout \\
\hline
\textbf{Comments} & \textbf{CAPEC-227:} Sustained Client Engagement \newline \textbf{CAPEC-469:} Futile Investment Exploitation \newline \textbf{Contromisure:} timeout automatico con logica di rimborso dopo 3 tentativi di validazione falliti \\
\hline
\end{longtable}

\subsubsection*{MISUSE CASE: D3.1-M}
% Misuse Case = Blu
\begin{longtable}{| >{\columncolor{misuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{misuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Misuse Case \\
\hline
\textbf{Use Case} & validazione Spedizione \\
\hline
\textbf{Case ID} & D3.1-M \\
\hline
\textbf{Case Name} & \textbf{timeout Connettività IoT (Absence of Resilience)} \\
\hline
\textbf{Actors} & sensore offline per guasto rete/alimentazione \\
\hline
\textbf{Description} & Un sensore legittimo perde la connettivit\`a durante il trasporto (batteria esaurita, zona senza copertura di rete, guasto al modem) e non riesce a trasmettere le evidenze, causando un blocco involontario dei fondi del mittente. \\
\hline
\textbf{Data} & evidenze trasmesse solo parzialmente, log di connettivit\`a del sensore \\
\hline
\textbf{Stimulus/Precond.} & - Spedizione in transito attraverso una zona remota con scarsa copertura \newline - Livello batteria del sensore sotto il 10\% \newline - Nessun meccanismo di memorizzazione locale e invio differito \\
\hline
\textbf{Basic Flow} & 1. La spedizione parte con tutti i sensori funzionanti \newline 2. Attraversando una zona montuosa si perde il segnale GSM \newline 3. Le evidenze E1 ed E2 vengono inviate, ma E3-E5 non vengono mai trasmesse \newline 4. La batteria del sensore si esaurisce \newline 5. La spedizione arriva a destinazione, ma senza evidenze complete \newline 6. I fondi del mittente restano bloccati (non intenzionalmente) \\
\hline
\textbf{Alternative Flow} & - Il sensore recupera la connessione appena in tempo e riesce a trasmettere le evidenze mancanti \newline - Le evidenze vengono recuperate manualmente dal logger interno del dispositivo \\
\hline
\textbf{Exception Flow} & - Il sistema rileva il timeout di 7 giorni e attiva il rimborso automatico al mittente \newline - Il corriere fornisce documentazione alternativa delle evidenze mancanti \\
\hline
\textbf{Response/Post.} & \textbf{Impatto:} il mittente deve attendere 7 giorni per il rimborso, il servizio risulta degradato, costi di opportunit\`a \newline \textbf{Requisiti non funzionali:} SLA con garanzia di disponibilit\`a al 99.5\%, batterie sostituibili a caldo, doppia SIM con failover automatico \\
\hline
\textbf{Comments} & \textbf{DUA-AoR:} il sistema non \`e sufficientemente resiliente a guasti infrastrutturali \newline \textbf{Contromisure consigliate:} buffer locale delle evidenze nel sensore, trasmissione in blocco al ripristino della connessione, percorsi di rete ridondanti \\
\hline
\end{longtable}

\subsection{T5.1 - Manipolazione CPT (Conditional Probability Tables)}

\subsubsection*{ABUSE CASE: T5.1-A}
% Abuse Case = Arancione
\begin{longtable}{| >{\columncolor{abuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{abuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Abuse Case \\
\hline
\textbf{Use Case} & configurazione Rete Bayesiana \\
\hline
\textbf{Case ID} & T5.1-A \\
\hline
\textbf{Case Name} & \textbf{insider Admin Attack su Parametri Bayesiani} \\
\hline
\textbf{Actors} & admin infedele con RUOLO\_ORACOLO \\
\hline
\textbf{Description} & Un amministratore con privilegi RUOLO\_ORACOLO modifica intenzionalmente le tabelle di probabilit\`a condizionate (CPT) per alterare la logica decisionale del sistema, favorendo validazioni fraudolente --- ad esempio impostando P(Esito$|$Freschezza=false) al 95\% invece del corretto 10\%. \\
\hline
\textbf{Data} & variabili CPT (cptEsitoFrFr, cptEsitoFrNF, cptFranchezzaAmb), chiave dell'amministratore \\
\hline
\textbf{Stimulus/Precond.} & - Admin con RUOLO\_ORACOLO compromesso (corruzione, ricatto, insider threat) \newline - Parametri CPT modificabili tramite la funzione \texttt{impostaCPT()} \newline - Evento \texttt{CPTImpostata} registra le modifiche, ma in assenza di monitoraggio attivo nessuno le nota \\
\hline
\textbf{Basic Flow} & 1. L'admin chiama \texttt{impostaCPT()} con valori fraudolenti \newline 2. Imposta \texttt{P(Esito|Freschezza=false, Franchezza=false) = 99\%} (dovrebbe essere $\sim$5\%) \newline 3. Qualsiasi spedizione, anche non conforme, supera la validazione \newline 4. Mittenti collusivi ricevono pagamenti indebiti \newline 5. L'integrit\`a del sistema di calcolo risulta completamente compromessa \\
\hline
\textbf{Alternative Flow} & - L'admin riduce le soglie (ad esempio \texttt{P(Esito|true,true) = 1\%}) per negare pagamenti a spedizioni legittime \\
\hline
\textbf{Exception Flow} & - Il monitoraggio rileva un tasso di approvazione anomalo (99\%) e genera un allarme \newline - Una governance multi-firma richiede l'approvazione di almeno 2 su 3 amministratori per modificare le CPT \\
\hline
\textbf{Response/Post.} & \textbf{Se l'attacco riesce:} perdita di integrit\`a del sistema, validazioni prive di significato, danno finanziario diffuso \newline \textbf{Rilevamento:} analisi statistica dei tassi di validazione, alert automatici sulle anomalie \\
\hline
\textbf{Comments} & \textbf{CAPEC-1:} Accessing Functionality Not Properly Constrained by ACLs \newline \textbf{CAPEC-122:} Privilege Abuse \newline \textbf{Contromisure consigliate:} governance multi-firma, parametri CPT bloccati dopo il deployment, votazione tramite DAO \\
\hline
\end{longtable}

\subsubsection*{MISUSE CASE: T5.1-M}
% Misuse Case = Blu
\begin{longtable}{| >{\columncolor{misuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{misuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Misuse Case \\
\hline
\textbf{Use Case} & configurazione Rete Bayesiana \\
\hline
\textbf{Case ID} & T5.1-M \\
\hline
\textbf{Case Name} & \textbf{errore Configurazione Probabilità (Human Error)} \\
\hline
\textbf{Actors} & admin inesperto/distratto \\
\hline
\textbf{Description} & Un amministratore commette un errore non intenzionale durante la configurazione delle CPT: un errore di battitura (scrive 150 anzich\'e 15), un'inversione della condizionalit\`a probabilistica, o un valore fuori scala. \\
\hline
\textbf{Data} & parametri CPT errati, hash della transazione di configurazione \\
\hline
\textbf{Stimulus/Precond.} & - L'admin aggiorna le CPT per incorporare un nuovo modello bayesiano \newline - La validazione del range 0-100 \`e implementata, ma non copre errori di tipo semantico \newline - Non esiste un ambiente di staging per effettuare test prima della messa in produzione \\
\hline
\textbf{Basic Flow} & 1. L'admin intende impostare un valore CPT pari a 15 (15\%) \newline 2. Digita erroneamente 150 --- ma il \texttt{require(\_cpt <= 100)} lo blocca con un revert \newline 3. Se per\`o non fosse presente la validazione, il valore verrebbe accettato producendo risultati incoerenti \newline 4. I calcoli probabilistici restituirebbero risultati fuori scala \newline 5. Le validazioni diventerebbero casuali e non basate sulle evidenze reali \\
\hline
\textbf{Alternative Flow} & - Errore di scala decimale: l'admin scrive \texttt{0.85} come \texttt{85} (il sistema lo interpreta come 8500\%) \newline - L'admin inverte la probabilit\`a condizionata: inserisce P(Esito$|$Freschezza) al posto di P(Freschezza$|$Esito) \\
\hline
\textbf{Exception Flow} & - Il controllo \texttt{require(value <= 100)} impedisce i valori fuori range \newline - Un test in ambiente di staging rileva l'incongruenza prima della messa in produzione \\
\hline
\textbf{Response/Post.} & \textbf{Impatto:} sistema instabile con decisioni errate fino al rollback, validazioni e rimborsi potenzialmente scorretti \newline \textbf{Requisiti non funzionali:} validazione degli input, test unitari sulle configurazioni, rilascio graduale \\
\hline
\textbf{Comments} & \textbf{DUA-Danger:} configurazione rischiosa senza adeguati meccanismi di protezione \newline \textbf{Contromisure:} valori vincolati nell'intervallo 1-100, verifica di coerenza dopo ogni impostazione, simulazione a secco prima dell'applicazione \\
\hline
\end{longtable}

\subsection{I6.1 - Data Mining Competitivo}

\subsubsection*{ABUSE CASE: I6.1-A}
% Abuse Case = Arancione
\begin{longtable}{| >{\columncolor{abuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{abuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Abuse Case \\
\hline
\textbf{Use Case} & consultazione Storico Spedizioni \\
\hline
\textbf{Case ID} & I6.1-A \\
\hline
\textbf{Case Name} & \textbf{analisi Competitiva Blockchain} \\
\hline
\textbf{Actors} & concorrente commerciale, Data analyst \\
\hline
\textbf{Description} & Un'azienda concorrente analizza le transazioni pubbliche registrate sulla blockchain per estrarre informazioni di intelligence competitiva: volumi di spedizioni, rotte ricorrenti, clienti abituali, periodi di picco e stime dei margini operativi (desumibili dai valori ETH). \\
\hline
\textbf{Data} & eventi \texttt{SpedizioneCreata}, \texttt{SpedizionePagata}, indirizzi mittenti/corrieri, importi ETH \\
\hline
\textbf{Stimulus/Precond.} & - Blockchain pubblica (Besu in modalit\`a permissioned, ma i log degli eventi restano accessibili) \newline - Gli eventi emessi non sono offuscati \newline - Gli indirizzi possono essere correlati a identit\`a reali (fuga di dati KYC, ingegneria sociale) \\
\hline
\textbf{Basic Flow} & 1. Il concorrente raccoglie tutti gli eventi \texttt{SpedizioneCreata} a partire dal blocco iniziale \newline 2. Raggruppa le transazioni per indirizzo del mittente e identifica i clienti principali \newline 3. Analizza i timestamp per rilevare picchi stagionali (ad esempio campagne vaccinali) \newline 4. Correla gli importi in ETH per stimare volumi e margini operativi \newline 5. Utilizza queste informazioni per proporre prezzi pi\`u bassi o acquisire clienti chiave \\
\hline
\textbf{Alternative Flow} & - Analisi dei pattern delle rotte per ottimizzazione logistica a proprio vantaggio \newline - Identificazione delle validazioni fallite per individuare debolezze del concorrente \\
\hline
\textbf{Exception Flow} & - L'hashing dei parametri sensibili (destinazioni, prodotti) limita la fuga di informazioni \newline - Prove a conoscenza zero sugli importi nascondono i margini operativi \\
\hline
\textbf{Response/Post.} & \textbf{Impatto:} perdita del vantaggio competitivo, esposizione di informazioni commerciali riservate \newline \textbf{Aspetto legale:} potenziale violazione del segreto industriale (a seconda della giurisdizione) \\
\hline
\textbf{Comments} & \textbf{CAPEC-116:} Excavation (raccolta informazioni) \newline \textbf{CAPEC-118:} Collect and Analyze Information \newline \textbf{Contromisure consigliate:} hash dei dati sensibili, accesso in lettura riservato agli stakeholder, transazioni private (Aztec, zkSNARK) \\
\hline
\end{longtable}

\subsection{S7.1 - Phishing/Spoofing UI}

\subsubsection*{ABUSE CASE: S7.1-A}
% Abuse Case = Arancione
\begin{longtable}{| >{\columncolor{abuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{abuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Abuse Case \\
\hline
\textbf{Use Case} & accesso DApp \\
\hline
\textbf{Case ID} & S7.1-A \\
\hline
\textbf{Case Name} & \textbf{cloning DApp Phishing} \\
\hline
\textbf{Actors} & attaccante phisher, Utente vittima \\
\hline
\textbf{Description} & L'attaccante crea una replica identica della DApp legittima (un clone del frontend) e la ospita su un dominio dal nome simile (typosquatting: ad esempio \texttt{bayesian-oracIe.com} con la I maiuscola al posto della L). L'obiettivo \`e sottrarre la seed phrase dell'utente o fargli firmare transazioni malevole. \\
\hline
\textbf{Data} & seed phrase di MetaMask, chiavi private, token di approvazione \\
\hline
\textbf{Stimulus/Precond.} & - L'utente riceve un link di phishing via email o social network \newline - Il frontend della DApp non \`e verificato (nessun badge ENS) \newline - L'utente non controlla l'URL nella barra degli indirizzi \\
\hline
\textbf{Basic Flow} & 1. L'attaccante registra il dominio \texttt{bayesian-0racle.com} (con lo zero al posto della O) \newline 2. Vi pubblica un clone della DApp con un backend malevolo \newline 3. Invia un'email: ``Aggiorna il wallet per la nuova versione'' \newline 4. L'utente clicca sul link e raggiunge il sito fasullo \newline 5. Compare un popup: ``Riconnetti MetaMask'' $\to$ l'utente inserisce la seed phrase \newline 6. L'attaccante cattura la seed e svuota il wallet \\
\hline
\textbf{Alternative Flow} & - Richiesta fasulla di ``approvazione contratto'' $\to$ l'utente firma \texttt{approve(attackerAddress, MAX\_UINT)} \newline - Iniezione di script malevolo tramite una CDN compromessa \\
\hline
\textbf{Exception Flow} & - L'estensione del browser (MetaMask PhishFort) blocca il dominio se gi\`a segnalato \newline - L'utente nota la differenza nell'URL \\
\hline
\textbf{Response/Post.} & \textbf{Se l'attacco riesce:} furto completo dei fondi nel wallet, compromissione dell'identit\`a on-chain \newline \textbf{Requisiti non funzionali:} formazione sulla sicurezza, HTTPS obbligatorio, header CSP \\
\hline
\textbf{Comments} & \textbf{CAPEC-98:} Phishing \newline \textbf{CAPEC-163:} Spear Phishing \newline \textbf{ATT\&CK-T1566:} Phishing \newline \textbf{Contromisure consigliate:} HTTPS con HSTS, verifica del nome ENS, collegamento sicuro tramite WalletConnect, avvisi educativi integrati nell'interfaccia \\
\hline
\end{longtable}

\subsubsection*{MISUSE CASE: S7.1-M}
% Misuse Case = Blu
\begin{longtable}{| >{\columncolor{misuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{misuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Misuse Case \\
\hline
\textbf{Use Case} & creazione Spedizione \\
\hline
\textbf{Case ID} & S7.1-M \\
\hline
\textbf{Case Name} & \textbf{errore Input Parametri (User Mistake)} \\
\hline
\textbf{Actors} & mittente distratto \\
\hline
\textbf{Description} & Un utente legittimo interagisce con la DApp autentica, ma commette un errore durante l'inserimento dei dati: indirizzo del corriere sbagliato, importo in ETH errato (1 ETH al posto di 0.1), parametro della spedizione invertito. \\
\hline
\textbf{Data} & parametri della transazione errati, commissioni gas \\
\hline
\textbf{Stimulus/Precond.} & - Form di creazione spedizione con campi a inserimento libero \newline - Validazione client-side presente ma non esaustiva su tutti i campi \newline - L'utente commette un errore durante il copia-incolla \\
\hline
\textbf{Basic Flow} & 1. Il mittente crea una spedizione con \texttt{valore = 1 ETH} (voleva scrivere 0.1) \newline 2. Conferma la transazione su MetaMask senza rileggere i dettagli \newline 3. La transazione viene eseguita con un importo 10 volte superiore \newline 4. La validazione ha esito positivo $\to$ il corriere riceve 1 ETH invece di 0.1 \newline 5. Il mittente perde 0.9 ETH senza possibilit\`a di annullamento \\
\hline
\textbf{Alternative Flow} & - Errore nell'indirizzo del corriere $\to$ i fondi finiscono a terzi \newline - Soglia di probabilit\`a inserita come 0.9 invece di 90 $\to$ il sistema la interpreta come 0\% \\
\hline
\textbf{Exception Flow} & - L'interfaccia mostra una conferma visiva: ``Stai per inviare 1.00 ETH, confermi?'' \newline - Uno slider al posto della casella di testo previene gli errori di digitazione \\
\hline
\textbf{Response/Post.} & \textbf{Impatto:} perdita economica per l'utente, impossibile annullare la transazione una volta confermata \newline \textbf{Requisiti non funzionali:} validazione nell'interfaccia (men\`u a tendina, slider, limiti massimi), finestra di conferma dettagliata \\
\hline
\textbf{Comments} & \textbf{DUA-Exposure:} un'interfaccia non a prova di errore espone gli utenti a sbagli costosi \newline \textbf{Contromisure consigliate:} vincoli sugli input, anteprima della transazione prima della firma, simulazione con periodo di attesa \\
\hline
\end{longtable}

\subsection{S8.1 - Furto Chiavi Private}

\subsubsection*{ABUSE CASE: S8.1-A}
% Abuse Case = Arancione
\begin{longtable}{| >{\columncolor{abuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{abuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Abuse Case \\
\hline
\textbf{Use Case} & gestione Wallet \\
\hline
\textbf{Case ID} & S8.1-A \\
\hline
\textbf{Case Name} & \textbf{keylogger/Malware Exfiltration} \\
\hline
\textbf{Actors} & attaccante con malware installato, Vittima \\
\hline
\textbf{Description} & L'attaccante installa un keylogger o un dirottatore degli appunti sul dispositivo della vittima per catturare la seed phrase durante il ripristino del wallet, oppure estrae le chiavi da uno storage non cifrato. \\
\hline
\textbf{Data} & seed phrase (12 o 24 parole), file keystore JSON, password di MetaMask \\
\hline
\textbf{Stimulus/Precond.} & - L'utente installa software compromesso (falso airdrop, software piratato) \newline - Il keylogger \`e attivo in background \newline - L'utente apre MetaMask per ripristinare il wallet \\
\hline
\textbf{Basic Flow} & 1. L'utente scarica un ``wallet optimizer tool'' malevolo \newline 2. Il malware installa un keylogger e un monitor degli appunti \newline 3. L'utente avvia il ripristino di MetaMask e digita la seed phrase \newline 4. Il keylogger cattura le parole e le invia al server di comando \newline 5. L'attaccante importa la seed nel proprio wallet \newline 6. Svuota immediatamente tutti i fondi (ETH e token) \\
\hline
\textbf{Alternative Flow} & - Un dirottatore degli appunti sostituisce l'indirizzo del destinatario con quello dell'attaccante durante il copia-incolla \newline - Un malware di cattura schermo fotografa la seed visualizzata sullo schermo \\
\hline
\textbf{Exception Flow} & - L'antivirus rileva e blocca il malware \newline - Un hardware wallet (Ledger/Trezor) non espone mai la seed al sistema operativo \\
\hline
\textbf{Response/Post.} & \textbf{Se l'attacco riesce:} furto totale dei fondi, compromissione permanente dell'identit\`a (la seed non pu\`o essere cambiata) \newline \textbf{Rilevamento:} lo svuotamento rapido del wallet \`e un segnale d'allarme, ma solitamente \`e gi\`a troppo tardi \\
\hline
\textbf{Comments} & \textbf{ATT\&CK-T1056.001:} Keylogging \newline \textbf{ATT\&CK-T1113:} Screen Capture \newline \textbf{CAPEC-568:} Capture Credentials via Keylogger \newline \textbf{Contromisure consigliate:} hardware wallet obbligatorio per asset di valore elevato, irrobustimento del sistema operativo, antivirus aggiornato, non digitare mai la seed su dispositivi connessi \\
\hline
\end{longtable}

\subsubsection*{MISUSE CASE: S8.1-M}
% Misuse Case = Blu
\begin{longtable}{| >{\columncolor{misuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{misuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Misuse Case \\
\hline
\textbf{Use Case} & backup Wallet \\
\hline
\textbf{Case ID} & S8.1-M \\
\hline
\textbf{Case Name} & \textbf{seed Phrase Salvata in Chiaro (User Negligence)} \\
\hline
\textbf{Actors} & utente inesperto/negligente \\
\hline
\textbf{Description} & L'utente salva la seed phrase in un formato non sicuro: screenshot sincronizzato nel cloud, email inviata a s\'e stesso, note sullo smartphone non cifrate, foto del backup fisico caricata su Google Photos. \\
\hline
\textbf{Data} & seed phrase in chiaro, backup nel cloud \\
\hline
\textbf{Stimulus/Precond.} & - Utente alle prime armi con le criptovalute, che non comprende la gravit\`a della seed \newline - Backup automatico nel cloud attivo per impostazione predefinita (iCloud, Google Drive) \newline - Nessuno strumento di gestione dei segreti \\
\hline
\textbf{Basic Flow} & 1. Alla creazione del wallet, MetaMask genera la seed phrase \newline 2. L'utente fa uno screenshot su iPhone ``per sicurezza'' \newline 3. iPhone carica automaticamente la foto su iCloud (impostazione predefinita) \newline 4. L'account iCloud viene compromesso (phishing, password debole, assenza 2FA) \newline 5. L'attaccante accede a Foto di iCloud e trova lo screenshot della seed \newline 6. Importa il wallet e svuota i fondi \\
\hline
\textbf{Alternative Flow} & - La seed viene scritta in un file \texttt{note.txt} sulla Scrivania sincronizzata con Dropbox \newline - Email ``Promemoria wallet'' inviata su Gmail con la seed in chiaro \\
\hline
\textbf{Exception Flow} & - L'utente utilizza un gestore di password cifrato (1Password, Bitwarden) \newline - Backup fisico conservato in cassaforte offline \\
\hline
\textbf{Response/Post.} & \textbf{Impatto:} furto dei fondi per negligenza, nessuna possibilit\`a di recupero \newline \textbf{Requisiti non funzionali:} tutorial educativo obbligatorio al primo avvio, avviso di MetaMask contro gli screenshot della seed \\
\hline
\textbf{Comments} & \textbf{DUA-Exposure:} mancanza di consapevolezza sulla sicurezza delle criptovalute \newline \textbf{Contromisure consigliate:} tutorial integrato sulla protezione della seed, blocco screenshot durante la visualizzazione, frazionamento tramite Shamir Secret Sharing (2 su 3 parti), social recovery (modello Argent) \\
\hline
\end{longtable}

\subsection{E4.1 - Escalation Privilegi Sistema Ruoli}

\subsubsection*{ABUSE CASE: E4.1-A}
% Abuse Case = Arancione
\begin{longtable}{| >{\columncolor{abuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{abuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Abuse Case \\
\hline
\textbf{Use Case} & assegnazione Ruoli \\
\hline
\textbf{Case ID} & E4.1-A \\
\hline
\textbf{Case Name} & \textbf{privilege Escalation via Function Selector Collision} \\
\hline
\textbf{Actors} & attaccante esperto Solidity \\
\hline
\textbf{Description} & L'attaccante sfrutta una (ipotetica) collisione sugli hash delle firme delle funzioni o una vulnerabilit\`a legata a \texttt{delegatecall} per aggirare il modificatore \texttt{onlyRole} e auto-assegnarsi il RUOLO\_ORACOLO o il DEFAULT\_ADMIN\_ROLE. \\
\hline
\textbf{Data} & collisione sulla firma della funzione, payload delegatecall \\
\hline
\textbf{Stimulus/Precond.} & - Il contratto non usa delegatecall (scenario ipotetico) \newline - Collisione sugli hash dei selettori di funzione (birthday attack su 4 byte) \newline - Assenza di check strict sull'origine della chiamata \\
\hline
\textbf{Basic Flow} & 1. L'attaccante identifica il selettore della funzione \texttt{grantRole(bytes32,address)}: \texttt{0x2f2ff15d} \newline 2. Cerca una funzione apparentemente innocua con lo stesso hash troncato \newline 3. Costruisce un payload che aggira il modificatore tramite la collisione \newline 4. Chiama la funzione ``innocua'' che esegue internamente \texttt{grantRole} \newline 5. Si auto-assegna il DEFAULT\_ADMIN\_ROLE \newline 6. Assume il controllo completo del sistema \\
\hline
\textbf{Alternative Flow} & - Delegatecall verso un contratto dell'attaccante con una fallback che chiama \texttt{\_grantRole} internamente \\
\hline
\textbf{Exception Flow} & - L'implementazione OpenZeppelin di AccessControl include protezioni contro le collisioni \newline - La visibilit\`a delle funzioni \`e controllata rigorosamente (public vs external) \\
\hline
\textbf{Response/Post.} & \textbf{Se l'attacco riesce:} presa di controllo completa del contratto, possibilit\`a di modificare la logica e drenare i fondi \newline \textbf{Gravit\`a:} CRITICA \\
\hline
\textbf{Comments} & \textbf{CAPEC-122:} Privilege Abuse \newline \textbf{ATT\&CK-T1078:} Valid Accounts (escalation dei privilegi) \newline \textbf{Contromisure:} utilizzo dell'ultima versione di OpenZeppelin, evitare delegatecall con input utente, verifica formale del controllo degli accessi \\
\hline
\end{longtable}

\subsection{I5.1 - Reverse Engineering CPT}

\subsubsection*{ABUSE CASE: I5.1-A}
% Abuse Case = Arancione
\begin{longtable}{| >{\columncolor{abuseCol}}p{0.25\textwidth} | p{0.70\textwidth} |}
\hline
\rowcolor{abuseHeader} \textcolor{white}{\textbf{Campo}} & \textcolor{white}{\textbf{Contenuto}} \\
\hline
\textbf{Case Type} & Abuse Case \\
\hline
\textbf{Use Case} & lettura Parametri Bayesiani \\
\hline
\textbf{Case ID} & I5.1-A \\
\hline
\textbf{Case Name} & \textbf{storage Slot Reading via Web3} \\
\hline
\textbf{Actors} & attaccante/Competitor \\
\hline
\textbf{Description} & Anche se le variabili CPT sono dichiarate \texttt{private}, un attaccante pu\`o usare \texttt{eth\_getStorageAt} per leggere direttamente gli slot di storage del contratto e decompilare il bytecode per ricostruire la mappatura dei parametri della rete bayesiana. \\
\hline
\textbf{Data} & bytecode del contratto, layout dello storage, valori delle CPT \\
\hline
\textbf{Stimulus/Precond.} & - Contratto pubblicato su una blockchain pubblica \newline - Le variabili CPT sono dichiarate \texttt{private} ma restano comunque leggibili via RPC \newline - L'attaccante conosce il layout dello storage di Solidity \\
\hline
\textbf{Basic Flow} & 1. L'attaccante ottiene l'indirizzo del contratto \newline 2. Usa \texttt{web3.eth.getStorageAt(address, slot)} per ogni slot da 0 a 20 \newline 3. Identifica il pattern delle strutture CPT nello storage \newline 4. Decompila il bytecode con strumenti specializzati (Dedaub, Etherscan) \newline 5. Ricostruisce la rete bayesiana completa \newline 6. Crea un sistema concorrente con la stessa logica (furto di propriet\`a intellettuale) \\
\hline
\textbf{Alternative Flow} & - Analisi dei dati delle transazioni per inferire le probabilit\`a dai risultati osservati \\
\hline
\textbf{Exception Flow} & - Offuscamento dello storage tramite cifratura on-chain (ma con costi gas elevati) \newline - Prove a conoscenza zero per calcolare le probabilit\`a senza esporre i parametri CPT \\
\hline
\textbf{Response/Post.} & \textbf{Impatto:} furto del modello bayesiano come propriet\`a intellettuale, replicazione del sistema, perdita del vantaggio competitivo \newline \textbf{Aspetto legale:} possibile violazione di brevetti o copyright sull'algoritmo \\
\hline
\textbf{Comments} & \textbf{CAPEC-188:} Reverse Engineering \newline \textbf{CAPEC-116:} Excavation \newline \textbf{Contromisure consigliate:} calcolo off-chain con oracolo fidato (Chainlink Functions), prove zkSNARK per validare senza rivelare i parametri, ambienti di esecuzione affidabili (TEE) \\
\hline
\end{longtable}

\section{Mapping CAPEC/ATT\&CK Completo}

\begin{tabularx}{\textwidth}{l l l L l}
\toprule
\textbf{Threat ID} & \textbf{STRIDE} & \textbf{CAPEC ID} & \textbf{CAPEC Name} & \textbf{ATT\&CK TTP} \\
\midrule
S2.1 & Spoofing & CAPEC-151 & identity Spoofing & T1134 \\
T2.1 & Tampering & CAPEC-94 & man-in-the-Middle & T1557 \\
T3.1 & Tampering & CAPEC-194 & fake Resource Injection & - \\
T5.1 & Tampering & CAPEC-1 & accessing Functionality Not Properly Constrained & T1078 \\
D3.1 & Denial & CAPEC-227 & sustained Client Engagement & T1499 \\
I6.1 & Info Disclosure & CAPEC-116 & excavation & T1213 \\
I5.1 & Info Disclosure & CAPEC-188 & reverse Engineering & - \\
S7.1 & Spoofing & CAPEC-98 & phishing & T1566.002 \\
S8.1 & Spoofing & CAPEC-568 & capture Credentials via Keylogger & T1056.001 \\
E4.1 & Elevation & CAPEC-122 & privilege Abuse & T1078.004 \\
\bottomrule
\end{tabularx}

\section{Riepilogo Mitigazioni per Asset}

\subsection*{A1 - Smart Contract}
\begin{itemize}
\item Audit formale del codice (ad esempio CertiK, Trail of Bits)
\item Verifica formale della logica (strumenti come Certora o K Framework)
\item Raccomandato: deployment tramite Gnosis Safe con multi-firma
\item Aggiornamenti con timelock (gestiti tramite governance esterna)
\item Programma di bug bounty per incentivare la scoperta di vulnerabilit\`a
\end{itemize}

\subsection*{A2 - Evidenze IoT}
\begin{itemize}
\item Firma digitale sulla transazione (autenticazione del mittente)
\item Autenticazione dei sensori tramite challenge-response (off-chain)
\item Limite di frequenza sugli invii (massimo 1 evidenza per sensore al minuto)
\item Ridondanza probabilistica (il modello bayesiano gestisce le incongruenze tra sensori)
\item Modulo di sicurezza hardware (HSM) per le chiavi dei sensori
\end{itemize}

\subsection*{A3 - Pagamenti ETH}
\begin{itemize}
\item Protezione da rientranza tramite OpenZeppelin ReentrancyGuard
\item Pattern CEI (Checks-Effects-Interactions)
\item Pagamento diretto protetto dal guard contro la rientranza
\item Rimborso automatico allo scadere del timeout (7 giorni)
\item Pausa di emergenza (pattern CircuitBreaker)
\end{itemize}

\subsection*{A4 - Ruoli e Permessi}
\begin{itemize}
\item Ultima versione di OpenZeppelin AccessControl
\item Raccomandato: Gnosis Safe con multi-firma per assegnazione e revoca dei ruoli critici
\item Registrazione eventi per tutte le operazioni sui ruoli
\item Monitoraggio delle anomalie nelle assegnazioni
\item Gestione ruoli isolata dalla DApp (solo via script di deployment, non esposta nell'interfaccia web)
\end{itemize}

\subsection*{A5 - CPT e Probabilit\`a}
\begin{itemize}
\item Visibilit\`a \texttt{private} con getter accessibile solo all'amministratore (\texttt{onlyRole})
\item Raccomandato: Gnosis Safe con multi-firma per la modifica dei parametri CPT
\item Validazione dell'intervallo di input (0-100) implementata direttamente nello smart contract
\item Ambienti di test pre-produzione
\item Pausa di emergenza (Pausable) per situazioni critiche
\end{itemize}

\subsection*{A6 - Dati Spedizioni}
\begin{itemize}
\item Hashing dei dati sensibili tramite \texttt{creaSpedizioneConHash()} (implementato)
\item [$\circ$] Accesso in lettura riservato agli stakeholder autorizzati (raccomandato)
\item [$\circ$] Archiviazione su IPFS dei dati voluminosi con hash di riferimento on-chain (raccomandato)
\item [$\circ$] Prove a conoscenza zero per interrogazioni che preservino la privacy (futuro)
\end{itemize}

\subsection*{A7 - Interfaccia Web}
\begin{itemize}
\item Sanificazione degli input e validazione lato client (implementato)
\item [$\circ$] HTTPS con HSTS obbligatorio (raccomandato per produzione)
\item [$\circ$] Policy di sicurezza dei contenuti - CSP (raccomandato per produzione)
\item [$\circ$] Integrit\`a delle risorse esterne - SRI per CDN (raccomandato)
\item [$\circ$] Badge di verifica del dominio ENS (futuro)
\item [$\circ$] Sessioni sicure tramite WalletConnect (futuro)
\end{itemize}

\subsection*{A8 - Chiavi Private}
\begin{itemize}
\item [$\circ$] Hardware wallet obbligatorio per asset di valore elevato (raccomandato)
\item [$\circ$] Onboarding educativo sulla sicurezza della seed phrase (raccomandato)
\item [$\circ$] Blocco screenshot durante la visualizzazione della seed (raccomandato)
\item [$\circ$] Social recovery (modello Argent) (futuro)
\item [$\circ$] Multi-sig wallet per organizzazioni (futuro)
\end{itemize}

\section{Metriche di Rischio Residuo}

\begin{tabularx}{\textwidth}{l l l L l}
\toprule
\textbf{Asset} & \textbf{Rischio inerente} & \textbf{Mitigazioni} & \textbf{Rischio residuo} & \textbf{Accettazione} \\
\midrule
A1 & CRITICO & Audit + Verifica formale & BASSO & $\checkmark$ Accettato \\
A2 & CRITICO & HSM + Firme digitali & MEDIO & $\checkmark$ Accettato \\
A3 & CRITICO & ReentrancyGuard + Timeout & BASSO & $\checkmark$ Accettato \\
A4 & ALTO & AccessControl + Eventi & BASSO & $\checkmark$ Accettato \\
A5 & ALTO & Private + Validazione input & MEDIO & $\checkmark$ Accettato \\
A6 & MEDIO & Hashing & BASSO & $\checkmark$ Accettato \\
A7 & MEDIO & Validazione input & MEDIO & \textbf{!} Necessaria formazione utente \\
A8 & CRITICO & Raccomandazione HW Wallet & ALTO & \textbf{!} Responsabilit\`a dell'utente \\
\bottomrule
\end{tabularx}

\textbf{Nota:} A7 e A8 mantengono un rischio residuo medio/alto perch\'e dipendono interamente dal comportamento dell'utente finale, aspetto che esula dal controllo diretto del sistema.

\section{Conclusioni}

L'analisi \textbf{DUAL-STRIDE} completa ha identificato:
\begin{itemize}
\item \textbf{25 scenari di minaccia} distribuiti sugli 8 asset del sistema
\item \textbf{9 abuse case} dettagliati (attacchi intenzionali)
\item \textbf{6 misuse case} dettagliati (errori e guasti accidentali)
\item \textbf{10 pattern CAPEC} di attacco mappati
\item \textbf{7 tattiche ATT\&CK} correlate
\end{itemize}

\textbf{Risultati principali:}
\begin{enumerate}
\item \textbf{Asset A8 (Chiavi Private)} rappresenta l'anello debole del sistema: nessuna contromisura tecnica pu\`o proteggere completamente dalla negligenza dell'utente finale
\item \textbf{Asset A3 (Fondi ETH)} necessita del ReentrancyGuard come misura imperativa, unitamente alla logica di timeout per il rimborso
\item \textbf{Asset A5 (CPT)} richiede una governance decentralizzata per evitare un singolo punto di fiducia nella configurazione dei parametri
\end{enumerate}

\textbf{Raccomandazioni Prioritarie:}
\begin{enumerate}
\item [$\checkmark$] Implementare ReentrancyGuard (già fatto)
\item [$\checkmark$] Timeout refund 7gg (già fatto)
\item [$\checkmark$] Circuit Breaker / Emergency Pause (già fatto)
\item [$\checkmark$] Rate Limiting sensori (già fatto - 1 min cooldown)
\item [$\checkmark$] Input Validation CPT range 0-100 (già fatto)
\item [\textcolor{orange}{$\bullet$}] \textbf{Raccomandato:} Gnosis Safe Multi-sig per governance admin
\item [\textcolor{orange}{$\bullet$}] \textbf{Raccomandato:} HSM per chiavi sensori IoT
\item [\textcolor{orange}{$\bullet$}] \textbf{Futuro:} zkSNARK per privacy CPT
\end{enumerate}

\textbf{Accettazione del rischio residuo:}
\begin{itemize}
\item Rischi A1-A6: accettati grazie alle mitigazioni implementate
\item Rischi A7-A8: accettati con riserva, subordinati alla formazione obbligatoria dell'utente finale
\end{itemize}
